const express = require('express');
const cors = require('cors');
const app = express();
const mysql = require('mysql');

const connection = mysql.createConnection({
    host: 'localhost',
    port: 3307,
    user: 'root',
    password: 'admin',
    database: 'costoSmart',
});

connection.connect((error) => {
    if (error) {
        console.error('Error al conectar a la base de datos:', error);
        return;
    }
    console.log('Conexión exitosa a la base de datos');
});

app.use(cors());
app.use(express.json());

app.get('/ingredientes', (req, res) => {
    const query = 'SELECT * FROM Ingredientes';

    connection.query(query, (error, results) => {
        if (error) {
            console.error('Error al consultar los datos:', error);
            res.status(500).json({ error: 'Error al consultar los datos' });
            return;
        }

        console.log('Datos de la tabla Ingredientes:');
        console.log(results);

        res.json(results);
    });
});

app.post('/ingredientes', (req, res) => {
    const { nombre, unidadMedida, tamanoPaquete, costo } = req.body;
    const query = 'INSERT INTO Ingredientes (nombre, unidad_medida, tamano_paquete, costo) VALUES (?, ?, ?, ?)';

    connection.query(query, [nombre, unidadMedida, tamanoPaquete, costo], (error, results) => {
        if (error) {
            console.error('Error al guardar el ingrediente:', error);
            res.status(500).json({ error: 'Error al guardar el ingrediente' });
            return;
        }

        console.log('Consulta SQL:', query);
        console.log('Valores pasados:', [nombre, unidadMedida, tamanoPaquete, costo]);
        console.log('Resultado de la consulta:', results);

        res.json({ success: true });
    });
});

// Nuevas rutas para el ABM de tortas
app.get('/tortas', (req, res) => {
    const query = 'SELECT * FROM recetas';

    connection.query(query, (error, results) => {
        if (error) {
            console.error('Error al consultar los datos de las tortas:', error);
            res.status(500).json({ error: 'Error al consultar los datos de las tortas' });
            return;
        }

        console.log('Datos de la tabla Tortas:');
        console.log(results);

        res.json(results);
    });
});



const PORT = 3000;

app.listen(PORT, () => {
    console.log(`Servidor corriendo en el puerto ${PORT}`);
});
